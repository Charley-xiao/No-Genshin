# CS207 2023 Fall Project: Mini Piano

小组成员：何家阳、邱天润、肖淇文

> 源码放在 GitHub 项目上，将会在项目结束后开源，其链接为：[Charley-xiao/No-Genshin: No Genshin Minipiano (github.com)](https://github.com/Charley-xiao/No-Genshin)

## 开发日程安排和实施情况
### 1.团队分工及贡献占比：
何家阳：学习模式功能的构建与实现，自动模式和用户系统的实现，曲库的建立，项目文档的编写。

邱天润：主模块与全局控制的构建与实现，VGA显示，LED灯管显示，项目视频的录制完成，项目文档的编写。

肖淇文：主模块与全局控制的构建与实现，手动模式和自动模式的实现，LED灯管显示。

**贡献百分比**相同，为**1:1:1**。

### 2. 开发计划日程安排
    1.项目需求分析与代码初步构建 2023/11/17~2023/11/22
    
    2.项目代码搭建，完成手动模式和自动模式 2023/11/23~2023/11/25
    
    3.学习模式实现 2023/11/26~2023/12/12
    
    4.完善功能，完成项目文档和视频工作 2023/12/13~2023/12/24
### 3. 实施情况
    1.第一次小组讨论，分析项目框架与状态图 2023/11/17
    
    2.第二次小组讨论，已完成项目代码搭建，完成手动（自由）模式和自动模式 2023/11/23~2023/11/25
    
    3.第三次小组讨论，实现七段数码管显示 2023/11/26~2023/12/2
    
    4.第四次小组讨论，VGA框架基础实现 2023/12/3~2023/12/6
    
    5.学习模式实现 2023/12/6~2023/12/12
    
    6.VGA功能实现 2023/12/13
    
    7.第五次小组讨论，完善功能，在答辩前完成功能和文档、视频的制作 2023/12/13~2023/12/25

### 4.心得
  由于各名成员学习任务重，小组采取不断集中完成模块化设计的方式逐步实现了整个项目，并在项目后期进行更详尽的分工，给予更多时间完成项目。经过整个项目的编写，我们对硬件语言有了更清晰的认识，积累了小组合作的优良经验，使每一位小组成员都受益匪浅。
## 系统功能列表与使用说明
**本项目实现了一个由EGO1控制的电子琴学习机，并具有以下功能：**

1. 根据拨码开关切换模式（00: 调整模式，01: 学习模式，10: 自动模式，11: 自由模式）。

2. 在自由模式下，可以通过拨动拨码开关演奏对应的音符，可以通过设置的拨码开关改变当前的八度（共三个八度）,并可以通过按钮改变升降调（00: 低，01: 中，10: 高）。

3. 在自动模式下，自动播放曲库中的歌曲，曲库中初始设置有4首歌曲，实现了播放不同长度的音符，歌曲会循环播放，可以通过按钮来切换歌曲或更换曲调，在七段数码管展现当前歌曲编号，音符对应的led灯亮起，在VGA实现当前歌曲名称和演奏的音符。

4. 在学习模式下，可以通过按钮切换曲目和当前账号（演奏时不能更改账号），用户需要拨动led灯对应的拨码开关来实现音符的播放，当音符播放对应的时间后，会转到下一个音符，用户需要将拨码开关拨回后继续演奏。演奏每个音符获得的分数会由用户拨动拨码开关对应的间隔时间来分级，演奏过程中会实时显示分数，演奏完成后会显示评级和分数并更新当前用户的最高评级（S，A，B，C 四档）。

5. 在调整模式下，会依次播放七个音符，依次选择对应的音符，就可以改变它们的默认对应关系。

**显示模块**包括led灯的显示（演奏音符）、七段数码管的显示（歌曲编号，账户id，分数，评级），VGA的显示（歌曲名称，账户id，分数，评级）。

**输入输出**介绍如下：

![image-20231224232149926](Project.assets/image-20231224232149926.png)

**顶层端口**如下：
| Port name   | Direction | Type       | Description          |
| ----------- | --------- | ---------- | -------------------- |
| clk         | input     | wire       | 总时钟信号           |
| sel         | input     | wire [6:0] | 选择的音符           |
| octave      | input     | wire [1:0] | 音高选择             |
| _mode       | input     | wire [1:0] | 模式选择             |
| butscale    | input     | wire       | 换音调               |
| up          | input     | wire       | 切换之后一首曲       |
| down        | input     | wire       | 切换之前一首曲       |
| user_switch | input     | wire       | 切换用户             |
| showaccount | input     | wire       | 显示用户信息         |
| speaker     | output    | wire       | 外放喇叭             |
| md          | output    | wire       | 调整音量             |
| led         | output    | [6:0]      | LED 灯管             |
| seg_out0    | output    | [7:0]      | 第一组七段数码管内容 |
| tub_sel0    | output    | [3:0]      | 第一组七段数码管控制 |
| seg_out1    | output    | [7:0]      | 第二组七段数码管内容 |
| tub_sel1    | output    | [3:0]      | 第二组七段数码管控制 |
| red         | output    | [3:0]      | VGA：红色信号        |
| green       | output    | [3:0]      | VGA：绿色信号        |
| blue        | output    | [3:0]      | VGA：蓝色信号        |
| hs          | output    | wire       | VGA：横向扫描波      |
| vs          | output    | wire       | VGA：纵向扫描波      |

并可以用下图展示：

<img src="Project.assets/image-20231224232337530.png" alt="image-20231224232337530" style="zoom:50%;" />

## 系统结构说明

# TODO

## 子模块功能说明

### 顶层模块：MiniPiano

![image-20231225000929454](Project.assets/image-20231225000929454.png)

内部直接实现子模块实例：

- `hex_to_decimal`，实现从会被默认转为16进制的二进制到每四位二进制代表一个十进制数字的转换器。
- `light_val_controller`，实现对七段数码管所显示内容的统一控制。
- `light_7seg_manager`，实现对七段数码管的直接操作。
- `debouncer`，实现按键消抖。
- `sel_alter_manager`，实现选择音符的重新安排（调整模式）的设置和实际使用。
- `buzzer`，实现不同音高发音的蜂鸣器模块。
- `vga`，VGA显示的控制模块，实现当前乐曲、当前模式和当前音符的显示。
- `InController`，手动模式的控制模块。
- `AutoController`，自动模式的控制模块。
- `LearnController`，学习模式的控制模块。

### 子模块： hex_to_decimal

<img src="Project.assets/image-20231225001812507.png" alt="image-20231225001812507" style="zoom:50%;" />

| Port name | Direction | Type   | Description                                               |
| --------- | --------- | ------ | --------------------------------------------------------- |
| data      | input     | [9:0]  | 输入的二进制数，最多10位                                  |
| out       | output    | [11:0] | 输出的表示10进制数的二进制表示，最多表现3位数因此有12位长 |

### 子模块：light_val_controller

<img src="Project.assets/image-20231225002120204.png" alt="image-20231225002120204" style="zoom:50%;" />

| Port name      | Direction | Type   | Description                              |
| -------------- | --------- | ------ | ---------------------------------------- |
| _mode          | input     | [1:0]  | 当前所处模式                             |
| num            | input     | [6:0]  | （自动/学习模式）当前曲子编号            |
| score          | input     | [11:0] | （学习模式）当前分数                     |
| cur_note_alter | input     | [2:0]  | （调整模式）当前在调整的对应音符         |
| grade          | input     | [1:0]  | （学习模式）评级                         |
| user_id        | input     | [7:0]  | （学习模式）用户ID                       |
| val_7seg       | output    | [31:0] | 输出的32位二进制，用于在七段数码管上输出 |

### 子模块：light_7seg_manager

<img src="Project.assets/image-20231225002605175.png" alt="image-20231225002605175" style="zoom:50%;" />

| Port name | Direction | Type   | Description                |
| --------- | --------- | ------ | -------------------------- |
| val       | input     | [31:0] | 输入的32位二进制，用于输出 |
| rst       | input     |        | 重置符号                   |
| clk       | input     |        | 时钟信号                   |
| _mode     | input     | [1:0]  | 当前所处模式               |
| seg_out0  | output    | [7:0]  | 第一组七段数码管内容       |
| tub_sel0  | output    | [3:0]  | 第一组七段数码管控制       |
| seg_out1  | output    | [7:0]  | 第二组七段数码管内容       |
| tub_sel1  | output    | [3:0]  | 第一组七段数码管控制       |

# TODO

## Bonus 实现说明

# TODO

## 项目总结

# TODO

## 对 Project 对想法和建议

如果我们出题，将会提供以下建议：

### 1. 游戏手柄

利用开发板实现一个全功能、高度可定制化的游戏手柄实现，并设计为可以用于操纵特定的一两款游戏，还可以具有多元的操控方案。

### 2. 智能家居终端

利用真实的传感器数据或者电脑模拟的数据，实现智能家居的自动控制，并可以手动增删新的家具，并管理各个家具的自动调整方式，如对热水器、空调自动设置温度，电动窗帘自动开合，智能门锁等进行模拟。

### 3. 真正的音乐播放器

利用纯粹的 Verilog，实现 WAV 文件的读取、解析和播放。实现以下功能：音乐解析播放，音乐 Metadata 解析，暂停/重播/切歌，文件管理。可能的Bonus：支持更多文件格式。

> 灵感来源：C++ Project by Site Fan and Kangrui Chen.

### 4. 电子表

利用开发板实现电子表，并支持以下功能：显示时间，设置时区并切换多种世界时钟，计时器，秒表（支持专业体育用秒表的功能），以及闹钟。
